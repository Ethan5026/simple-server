<div class="page-header">
  <h1 class="page-title">Users</h1>
</div>

<% @users_by_district.sort.each do |district, users| %>

  <h2 class="mt-3"><%= district %></h2>
  
        <% users.sort_by(&:full_name).each do |user| %>
            <div class="card">
                <div class="row">
                    <div class="col">
                        <h5 class="mb-1"><%= link_to user.full_name, [:admin, user] %></h5>
                        <div>
                            <span class="label <%= user.sync_approval_status %>">Status: "<%= user.sync_approval_status&.capitalize %>" - </span>
                            <%= user.sync_approval_status_reason %>.
                            
                            <% if user.registration_facility.present? %>
                                Registration facility: 
                                <% facility = user.registration_facility %>

                                <% if policy(facility).show? %>
                                  <%= link_to facility.name, [:admin, facility.facility_group, facility] %>
                                <% else %>
                                  <%= user.registration_facility.name %>
                                <% end %>
                            <% end %>
                        </div>
                        <div class="mt-2">
                        <a href="tel:<%= user.phone_number %>" class="btn btn-sm btn-outline-primary"><i class="fas fa-phone"></i> <%= user.phone_number %></a>
                        </div>
                    </div>
                    <div class="col text-right">
                      <% unless user.sync_approval_status == 'allowed' %>
                        <%= link_to 'Allow', admin_user_enable_access_path(user), method: :put, data: { confirm: I18n.t('admin.enable_access_alert') }, class: 'btn btn-sm btn-outline-success' %>
                      <% end %>
                      <% unless user.sync_approval_status == 'denied' %>
                        <%= link_to 'Deny', '#deny-access-modal-' + user.id, 'data-toggle' => 'modal', class: 'btn btn-sm btn-outline-danger' %>
                      <% end %>
                      <% if policy(user).edit? %>
                        <%= link_to 'Edit', edit_admin_user_path(user), class: 'btn btn-sm btn-outline-primary' %>
                      <% end %>

                      <%= render partial: "deny_access_modal", locals: { user: user } %>
                    </div>
                </div>
          </div>
        <% end %>

<% end %>
