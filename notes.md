

  # def data_map
  #   [
  #     {
  #       "Facilities" => {
  #         "aggregate" => lambda { |size| "All #{Facility.localized_facility_size(size, pluralize: true)}" },
  #         "facility" => lambda { |facility| facility_data.region.source }
  #       }
  #     },
  #     {
  #     }
  #   ]
  # end

  # row = {}
  # data_map.each do |hsh|
  #   hsh.each_pair do |k,v|
  #     row[k] = v["aggregate"].call(size)
  #   end
  # end


pp @data_for_facility
{"UHC Mint Crossing"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>19,
     <Period type:month value=2021-05-01>=>27,
     <Period type:month value=2021-06-01>=>35,
     <Period type:month value=2021-07-01>=>41,
     <Period type:month value=2021-08-01>=>54,
     <Period type:month value=2021-09-01>=>61},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>6,
     <Period type:month value=2021-09-01>=>7},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>3,
     <Period type:month value=2021-09-01>=>4},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>41,
     <Period type:month value=2021-05-01>=>54,
     <Period type:month value=2021-06-01>=>61,
     <Period type:month value=2021-07-01>=>67,
     <Period type:month value=2021-08-01>=>73,
     <Period type:month value=2021-09-01>=>79},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>43,
     <Period type:month value=2021-05-01>=>56,
     <Period type:month value=2021-06-01>=>64,
     <Period type:month value=2021-07-01>=>70,
     <Period type:month value=2021-08-01>=>76,
     <Period type:month value=2021-09-01>=>82},
   :facility=>
    #<Facility:0x00007fb3c70530c0
     id: "469e7c2e-749e-422e-b356-7311f9ec5e3b",
     name: "UHC Mint Crossing",
     street_address: "Gr Floor, Plot No 260, Mehar Bldg, Sector 28, Vashi",
     village_or_colony: "Mint Crossing",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "486656",
     facility_type: "UHC",
     created_at: Sun, 15 Nov 2020 11:03:59 IST +05:30,
     updated_at: Sun, 15 Nov 2020 11:03:59 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "uhc-mint-crossing",
     zone: "Kardal Plateau",
     enable_diabetes_management: true,
     facility_size: "small",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"small",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>63,
     <Period type:month value=2021-05-01>=>74,
     <Period type:month value=2021-06-01>=>69,
     <Period type:month value=2021-07-01>=>73,
     <Period type:month value=2021-08-01>=>63,
     <Period type:month value=2021-09-01>=>70},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>12,
     <Period type:month value=2021-05-01>=>20,
     <Period type:month value=2021-06-01>=>24,
     <Period type:month value=2021-07-01>=>30,
     <Period type:month value=2021-08-01>=>34,
     <Period type:month value=2021-09-01>=>43},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>37,
     <Period type:month value=2021-05-01>=>26,
     <Period type:month value=2021-06-01>=>31,
     <Period type:month value=2021-07-01>=>27,
     <Period type:month value=2021-08-01>=>30,
     <Period type:month value=2021-09-01>=>23},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>7,
     <Period type:month value=2021-05-01>=>7,
     <Period type:month value=2021-06-01>=>11,
     <Period type:month value=2021-07-01>=>11,
     <Period type:month value=2021-08-01>=>16,
     <Period type:month value=2021-09-01>=>14}},
 "PHC Radicchioville"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>34,
     <Period type:month value=2021-05-01>=>35,
     <Period type:month value=2021-06-01>=>33,
     <Period type:month value=2021-07-01>=>35,
     <Period type:month value=2021-08-01>=>35,
     <Period type:month value=2021-09-01>=>36},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>3,
     <Period type:month value=2021-05-01>=>3,
     <Period type:month value=2021-06-01>=>3,
     <Period type:month value=2021-07-01>=>3,
     <Period type:month value=2021-08-01>=>6,
     <Period type:month value=2021-09-01>=>8},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>1,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>2,
     <Period type:month value=2021-09-01>=>3},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>50,
     <Period type:month value=2021-05-01>=>52,
     <Period type:month value=2021-06-01>=>52,
     <Period type:month value=2021-07-01>=>54,
     <Period type:month value=2021-08-01>=>62,
     <Period type:month value=2021-09-01>=>65},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>52,
     <Period type:month value=2021-05-01>=>54,
     <Period type:month value=2021-06-01>=>54,
     <Period type:month value=2021-07-01>=>56,
     <Period type:month value=2021-08-01>=>64,
     <Period type:month value=2021-09-01>=>67},
   :facility=>
    #<Facility:0x00007fb3c7052f58
     id: "d19b7e95-8214-42da-acd3-c42a13a462e9",
     name: "PHC Radicchioville",
     street_address: "14 Basement Raheja Complex 834, Anna Salai",
     village_or_colony: "Radicchioville",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "589454",
     facility_type: "PHC",
     created_at: Tue, 20 Aug 2019 18:00:04 IST +05:30,
     updated_at: Tue, 20 Aug 2019 18:00:04 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "phc-radicchioville",
     zone: "Ox Knee Gardens",
     enable_diabetes_management: true,
     facility_size: "small",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"small",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>74,
     <Period type:month value=2021-05-01>=>66,
     <Period type:month value=2021-06-01>=>64,
     <Period type:month value=2021-07-01>=>69,
     <Period type:month value=2021-08-01>=>69,
     <Period type:month value=2021-09-01>=>61},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>25,
     <Period type:month value=2021-05-01>=>23,
     <Period type:month value=2021-06-01>=>21,
     <Period type:month value=2021-07-01>=>24,
     <Period type:month value=2021-08-01>=>24,
     <Period type:month value=2021-09-01>=>22},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>24,
     <Period type:month value=2021-05-01>=>31,
     <Period type:month value=2021-06-01>=>33,
     <Period type:month value=2021-07-01>=>29,
     <Period type:month value=2021-08-01>=>26,
     <Period type:month value=2021-09-01>=>31},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>8,
     <Period type:month value=2021-05-01>=>11,
     <Period type:month value=2021-06-01>=>11,
     <Period type:month value=2021-07-01>=>10,
     <Period type:month value=2021-08-01>=>9,
     <Period type:month value=2021-09-01>=>11}},
 "Standalone Ginger Bay"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>12,
     <Period type:month value=2021-05-01>=>12,
     <Period type:month value=2021-06-01>=>12,
     <Period type:month value=2021-07-01>=>15,
     <Period type:month value=2021-08-01>=>14,
     <Period type:month value=2021-09-01>=>13},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>8,
     <Period type:month value=2021-05-01>=>8,
     <Period type:month value=2021-06-01>=>8,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>1,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>17,
     <Period type:month value=2021-05-01>=>18,
     <Period type:month value=2021-06-01>=>18,
     <Period type:month value=2021-07-01>=>18,
     <Period type:month value=2021-08-01>=>18,
     <Period type:month value=2021-09-01>=>22},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>18,
     <Period type:month value=2021-05-01>=>19,
     <Period type:month value=2021-06-01>=>19,
     <Period type:month value=2021-07-01>=>19,
     <Period type:month value=2021-08-01>=>19,
     <Period type:month value=2021-09-01>=>23},
   :facility=>
    #<Facility:0x00007fb3c7052dc8
     id: "d6a69e55-7cd0-4f7b-984f-2c33f7d6108c",
     name: "Standalone Ginger Bay",
     street_address: "Gr Floor, Plot No 260, Mehar Bldg, Sector 28, Vashi",
     village_or_colony: "Ginger Bay",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "092203",
     facility_type: "Standalone",
     created_at: Tue, 24 Mar 2020 07:37:36 IST +05:30,
     updated_at: Tue, 24 Mar 2020 07:37:36 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "standalone-ginger-bay",
     zone: "Ox Knee Gardens",
     enable_diabetes_management: true,
     facility_size: "small",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"small",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>75,
     <Period type:month value=2021-05-01>=>83,
     <Period type:month value=2021-06-01>=>83,
     <Period type:month value=2021-07-01>=>93,
     <Period type:month value=2021-08-01>=>79,
     <Period type:month value=2021-09-01>=>77},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>9,
     <Period type:month value=2021-05-01>=>10,
     <Period type:month value=2021-06-01>=>10,
     <Period type:month value=2021-07-01>=>14,
     <Period type:month value=2021-08-01>=>11,
     <Period type:month value=2021-09-01>=>10},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>17,
     <Period type:month value=2021-05-01>=>8,
     <Period type:month value=2021-06-01>=>8,
     <Period type:month value=2021-07-01>=>7,
     <Period type:month value=2021-08-01>=>21,
     <Period type:month value=2021-09-01>=>23},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>2,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>3,
     <Period type:month value=2021-09-01>=>3}},
 "CHC Sumac Bay"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>2,
     <Period type:month value=2021-08-01>=>3,
     <Period type:month value=2021-09-01>=>4},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>2,
     <Period type:month value=2021-05-01>=>3,
     <Period type:month value=2021-06-01>=>4,
     <Period type:month value=2021-07-01>=>7,
     <Period type:month value=2021-08-01>=>8,
     <Period type:month value=2021-09-01>=>9},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>2,
     <Period type:month value=2021-05-01>=>3,
     <Period type:month value=2021-06-01>=>4,
     <Period type:month value=2021-07-01>=>7,
     <Period type:month value=2021-08-01>=>8,
     <Period type:month value=2021-09-01>=>9},
   :facility=>
    #<Facility:0x00007fb3c7052af8
     id: "b36b185a-a03f-44d6-bfad-014ee0f44b19",
     name: "CHC Sumac Bay",
     street_address: "14 Basement Raheja Complex 834, Anna Salai",
     village_or_colony: "Sumac Bay",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "529152",
     facility_type: "CHC",
     created_at: Sat, 06 Mar 2021 12:10:11 IST +05:30,
     updated_at: Sat, 06 Mar 2021 12:10:11 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "chc-sumac-bay",
     zone: "Kardal Plateau",
     enable_diabetes_management: true,
     facility_size: "medium",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"medium",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>50,
     <Period type:month value=2021-08-01>=>67,
     <Period type:month value=2021-09-01>=>75},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>2,
     <Period type:month value=2021-09-01>=>3},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>100,
     <Period type:month value=2021-06-01>=>100,
     <Period type:month value=2021-07-01>=>50,
     <Period type:month value=2021-08-01>=>33,
     <Period type:month value=2021-09-01>=>25},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>1,
     <Period type:month value=2021-09-01>=>1}},
 "PHC Pepperleaf Town"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>24,
     <Period type:month value=2021-05-01>=>29,
     <Period type:month value=2021-06-01>=>28,
     <Period type:month value=2021-07-01>=>31,
     <Period type:month value=2021-08-01>=>35,
     <Period type:month value=2021-09-01>=>37},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>4,
     <Period type:month value=2021-05-01>=>3,
     <Period type:month value=2021-06-01>=>4,
     <Period type:month value=2021-07-01>=>6,
     <Period type:month value=2021-08-01>=>9,
     <Period type:month value=2021-09-01>=>5},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>1,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>2,
     <Period type:month value=2021-08-01>=>3,
     <Period type:month value=2021-09-01>=>2},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>39,
     <Period type:month value=2021-05-01>=>42,
     <Period type:month value=2021-06-01>=>43,
     <Period type:month value=2021-07-01>=>47,
     <Period type:month value=2021-08-01>=>48,
     <Period type:month value=2021-09-01>=>48},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>40,
     <Period type:month value=2021-05-01>=>43,
     <Period type:month value=2021-06-01>=>44,
     <Period type:month value=2021-07-01>=>48,
     <Period type:month value=2021-08-01>=>49,
     <Period type:month value=2021-09-01>=>49},
   :facility=>
    #<Facility:0x00007fb3c7052558
     id: "14f1b65d-28c3-402c-b1d1-026c51d1116d",
     name: "PHC Pepperleaf Town",
     street_address: "3, Mathura Chaya, Navghar Road, Bhayander",
     village_or_colony: "Pepperleaf Town",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "322515",
     facility_type: "PHC",
     created_at: Sat, 12 Oct 2019 07:24:12 IST +05:30,
     updated_at: Sat, 12 Oct 2019 07:24:12 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "phc-pepperleaf-town",
     zone: "Kardal Plateau",
     enable_diabetes_management: false,
     facility_size: "small",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"small",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>63,
     <Period type:month value=2021-05-01>=>62,
     <Period type:month value=2021-06-01>=>57,
     <Period type:month value=2021-07-01>=>65,
     <Period type:month value=2021-08-01>=>57,
     <Period type:month value=2021-09-01>=>54},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>15,
     <Period type:month value=2021-05-01>=>18,
     <Period type:month value=2021-06-01>=>16,
     <Period type:month value=2021-07-01>=>20,
     <Period type:month value=2021-08-01>=>20,
     <Period type:month value=2021-09-01>=>20},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>29,
     <Period type:month value=2021-05-01>=>34,
     <Period type:month value=2021-06-01>=>39,
     <Period type:month value=2021-07-01>=>29,
     <Period type:month value=2021-08-01>=>34,
     <Period type:month value=2021-09-01>=>41},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>7,
     <Period type:month value=2021-05-01>=>10,
     <Period type:month value=2021-06-01>=>11,
     <Period type:month value=2021-07-01>=>9,
     <Period type:month value=2021-08-01>=>12,
     <Period type:month value=2021-09-01>=>15}},
 "Village Herbes de Provence"=>
  {:adjusted_patient_counts=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :controlled_patients_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :controlled_patients=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :cumulative_assigned_patients=>
    {<Period type:month value=2021-04-01>=>1,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>1,
     <Period type:month value=2021-09-01>=>1},
   :cumulative_registrations=>
    {<Period type:month value=2021-04-01>=>1,
     <Period type:month value=2021-05-01>=>1,
     <Period type:month value=2021-06-01>=>1,
     <Period type:month value=2021-07-01>=>1,
     <Period type:month value=2021-08-01>=>1,
     <Period type:month value=2021-09-01>=>1},
   :facility=>
    #<Facility:0x00007fb3c7052238
     id: "fa4e97a7-01d3-4c3c-bc30-763e92f08cf5",
     name: "Village Herbes de Provence",
     street_address: "215, 4th Main 3rd Ph, JP Nagar",
     village_or_colony: "Herbes de Provence",
     district: "Alder County",
     state: "Amethyst State",
     country: "India",
     pin: "746177",
     facility_type: "Village",
     created_at: Mon, 22 Jul 2019 15:59:18 IST +05:30,
     updated_at: Mon, 22 Jul 2019 15:59:18 IST +05:30,
     latitude: nil,
     longitude: nil,
     deleted_at: nil,
     facility_group_id: "548791e7-1f54-4ebf-ada8-bf199821ef0d",
     slug: "village-herbes-de-provence",
     zone: "Ox Knee Gardens",
     enable_diabetes_management: false,
     facility_size: "community",
     monthly_estimated_opd_load: 300,
     enable_teleconsultation: false>,
   :facility_size=>"community",
   :missed_visits_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :missed_visits=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :period_info=>
    {<Period type:month value=2021-04-01>=>
      {:name=>"Apr-2021",
       :ltfu_since_date=>"30-Apr-2020",
       :bp_control_start_date=>"1-Feb-2021",
       :bp_control_end_date=>"30-Apr-2021",
       :bp_control_registration_date=>"31-Jan-2021"},
     <Period type:month value=2021-05-01>=>
      {:name=>"May-2021",
       :ltfu_since_date=>"31-May-2020",
       :bp_control_start_date=>"1-Mar-2021",
       :bp_control_end_date=>"31-May-2021",
       :bp_control_registration_date=>"28-Feb-2021"},
     <Period type:month value=2021-06-01>=>
      {:name=>"Jun-2021",
       :ltfu_since_date=>"30-Jun-2020",
       :bp_control_start_date=>"1-Apr-2021",
       :bp_control_end_date=>"30-Jun-2021",
       :bp_control_registration_date=>"31-Mar-2021"},
     <Period type:month value=2021-07-01>=>
      {:name=>"Jul-2021",
       :ltfu_since_date=>"31-Jul-2020",
       :bp_control_start_date=>"1-May-2021",
       :bp_control_end_date=>"31-Jul-2021",
       :bp_control_registration_date=>"30-Apr-2021"},
     <Period type:month value=2021-08-01>=>
      {:name=>"Aug-2021",
       :ltfu_since_date=>"31-Aug-2020",
       :bp_control_start_date=>"1-Jun-2021",
       :bp_control_end_date=>"31-Aug-2021",
       :bp_control_registration_date=>"31-May-2021"},
     <Period type:month value=2021-09-01>=>
      {:name=>"Sep-2021",
       :ltfu_since_date=>"30-Sep-2020",
       :bp_control_start_date=>"1-Jul-2021",
       :bp_control_end_date=>"30-Sep-2021",
       :bp_control_registration_date=>"30-Jun-2021"}},
   :uncontrolled_patients_rate=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0},
   :uncontrolled_patients=>
    {<Period type:month value=2021-04-01>=>0,
     <Period type:month value=2021-05-01>=>0,
     <Period type:month value=2021-06-01>=>0,
     <Period type:month value=2021-07-01>=>0,
     <Period type:month value=2021-08-01>=>0,
     <Period type:month value=2021-09-01>=>0}}}


########################################################
########################################################
########################################################
########################################################

pp @stats_by_size (v1)
{"small"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>103,
       :cumulative_assigned_patients=>166,
       :cumulative_registrations=>172,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>108,
       :cumulative_assigned_patients=>174,
       :cumulative_registrations=>181,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>122,
       :cumulative_assigned_patients=>186,
       :cumulative_registrations=>193,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>138,
       :cumulative_assigned_patients=>201,
       :cumulative_registrations=>208,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>147,
       :cumulative_assigned_patients=>214,
       :cumulative_registrations=>221,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>151,
       :cumulative_assigned_patients=>223,
       :cumulative_registrations=>230,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0}}},
 "medium"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>1,
       :cumulative_assigned_patients=>3,
       :cumulative_registrations=>3,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>1,
       :cumulative_assigned_patients=>4,
       :cumulative_registrations=>4,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>2,
       :cumulative_assigned_patients=>7,
       :cumulative_registrations=>7,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>3,
       :cumulative_assigned_patients=>8,
       :cumulative_registrations=>8,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>4,
       :cumulative_assigned_patients=>9,
       :cumulative_registrations=>9,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>7,
       :cumulative_assigned_patients=>9,
       :cumulative_registrations=>9,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0}}},
 "community"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       "controlled_patients"=>0}}}}

###################################  AFTER I CHANGED CODE

pp @stats_by_size  (v2)
{"small"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>103,
       :cumulative_assigned_patients=>166,
       :cumulative_registrations=>172,
       :controlled_patients_rate=>3,
       :controlled_patients=>3,
       :uncontrolled_patients=>29,
       :uncontrolled_patients_rate=>28,
       :missed_visits=>71,
       :missed_visits_rate=>69},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>108,
       :cumulative_assigned_patients=>174,
       :cumulative_registrations=>181,
       :controlled_patients_rate=>3,
       :controlled_patients=>3,
       :uncontrolled_patients=>34,
       :uncontrolled_patients_rate=>31,
       :missed_visits=>71,
       :missed_visits_rate=>66},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>122,
       :cumulative_assigned_patients=>186,
       :cumulative_registrations=>193,
       :controlled_patients_rate=>2,
       :controlled_patients=>3,
       :uncontrolled_patients=>31,
       :uncontrolled_patients_rate=>25,
       :missed_visits=>88,
       :missed_visits_rate=>72},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>138,
       :cumulative_assigned_patients=>201,
       :cumulative_registrations=>208,
       :controlled_patients_rate=>6,
       :controlled_patients=>8,
       :uncontrolled_patients=>40,
       :uncontrolled_patients_rate=>29,
       :missed_visits=>89,
       :missed_visits_rate=>64},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>147,
       :cumulative_assigned_patients=>214,
       :cumulative_registrations=>221,
       :controlled_patients_rate=>6,
       :controlled_patients=>9,
       :uncontrolled_patients=>43,
       :uncontrolled_patients_rate=>29,
       :missed_visits=>95,
       :missed_visits_rate=>65},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>151,
       :cumulative_assigned_patients=>223,
       :cumulative_registrations=>230,
       :controlled_patients_rate=>7,
       :controlled_patients=>11,
       :uncontrolled_patients=>48,
       :uncontrolled_patients_rate=>32,
       :missed_visits=>39,
       :missed_visits_rate=>26}}},
 "medium"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>1,
       :cumulative_assigned_patients=>3,
       :cumulative_registrations=>3,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>1,
       :uncontrolled_patients_rate=>100,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>1,
       :cumulative_assigned_patients=>4,
       :cumulative_registrations=>4,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>1,
       :uncontrolled_patients_rate=>100,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>2,
       :cumulative_assigned_patients=>7,
       :cumulative_registrations=>7,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>1,
       :uncontrolled_patients_rate=>50,
       :missed_visits=>1,
       :missed_visits_rate=>50},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>3,
       :cumulative_assigned_patients=>8,
       :cumulative_registrations=>8,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>1,
       :uncontrolled_patients_rate=>33,
       :missed_visits=>2,
       :missed_visits_rate=>67},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>4,
       :cumulative_assigned_patients=>9,
       :cumulative_registrations=>9,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>1,
       :uncontrolled_patients_rate=>25,
       :missed_visits=>3,
       :missed_visits_rate=>75},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>7,
       :cumulative_assigned_patients=>9,
       :cumulative_registrations=>9,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>2,
       :uncontrolled_patients_rate=>29,
       :missed_visits=>5,
       :missed_visits_rate=>71}}},
 "community"=>
  {:periods=>
    {<Period type:month value=2021-05-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-06-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-07-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-08-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-09-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0},
     <Period type:month value=2021-10-01>=>
      {:adjusted_patient_counts=>0,
       :cumulative_assigned_patients=>1,
       :cumulative_registrations=>1,
       :controlled_patients_rate=>0,
       :controlled_patients=>0,
       :uncontrolled_patients=>0,
       :uncontrolled_patients_rate=>0,
       :missed_visits=>0,
       :missed_visits_rate=>0}}}}

###################################################################

THIS FORMAT IS OBSELETE,
aggregate[size]["facilities"] now includes all three rate types in each element

pp aggregate_data
{"medium"=>
  {"aggregate"=>
    {"Facilities"=>"All CHCs",
     "Total assigned"=>"9",
     "Total registered"=>"9",
     :controlled_patients_rate=>
      {"6 month change"=>0,
       <Period type:month value=2021-05-01>=>0,
       <Period type:month value=2021-06-01>=>0,
       <Period type:month value=2021-07-01>=>0,
       <Period type:month value=2021-08-01>=>0,
       <Period type:month value=2021-09-01>=>0,
       <Period type:month value=2021-10-01>=>0},
     :uncontrolled_patients_rate=>
      {"6 month change"=>-71,
       <Period type:month value=2021-05-01>=>100,
       <Period type:month value=2021-06-01>=>100,
       <Period type:month value=2021-07-01>=>50,
       <Period type:month value=2021-08-01>=>33,
       <Period type:month value=2021-09-01>=>25,
       <Period type:month value=2021-10-01>=>29},
     :missed_visits_rate=>
      {"6 month change"=>71,
       <Period type:month value=2021-05-01>=>0,
       <Period type:month value=2021-06-01>=>0,
       <Period type:month value=2021-07-01>=>50,
       <Period type:month value=2021-08-01>=>67,
       <Period type:month value=2021-09-01>=>75,
       <Period type:month value=2021-10-01>=>71}},
   "facilities"=>
    [{"Facilities"=>"CHC Sumac Bay",
      "Total assigned"=>"9",
      "Total registered"=>"9",
      "6 month change"=>"0%",
      <Period type:month value=2021-05-01>=>"0%",
      <Period type:month value=2021-06-01>=>"0%",
      <Period type:month value=2021-07-01>=>"0%",
      <Period type:month value=2021-08-01>=>"0%",
      <Period type:month value=2021-09-01>=>"0%",
      <Period type:month value=2021-10-01>=>"0%"}]},
 "small"=>
  {"aggregate"=>
    {"Facilities"=>"All PHCs",
     "Total assigned"=>"223",
     "Total registered"=>"230",
     :controlled_patients_rate=>
      {"6 month change"=>4,
       <Period type:month value=2021-05-01>=>3,
       <Period type:month value=2021-06-01>=>3,
       <Period type:month value=2021-07-01>=>2,
       <Period type:month value=2021-08-01>=>6,
       <Period type:month value=2021-09-01>=>6,
       <Period type:month value=2021-10-01>=>7},
     :uncontrolled_patients_rate=>
      {"6 month change"=>4,
       <Period type:month value=2021-05-01>=>28,
       <Period type:month value=2021-06-01>=>31,
       <Period type:month value=2021-07-01>=>25,
       <Period type:month value=2021-08-01>=>29,
       <Period type:month value=2021-09-01>=>29,
       <Period type:month value=2021-10-01>=>32},
     :missed_visits_rate=>
      {"6 month change"=>-43,
       <Period type:month value=2021-05-01>=>69,
       <Period type:month value=2021-06-01>=>66,
       <Period type:month value=2021-07-01>=>72,
       <Period type:month value=2021-08-01>=>64,
       <Period type:month value=2021-09-01>=>65,
       <Period type:month value=2021-10-01>=>26}},
   "facilities"=>
    [{"Facilities"=>"UHC Mint Crossing",
      "Total assigned"=>"84",
      "Total registered"=>"87",
      "6 month change"=>"+8%",
      <Period type:month value=2021-05-01>=>"0%",
      <Period type:month value=2021-06-01>=>"0%",
      <Period type:month value=2021-07-01>=>"0%",
      <Period type:month value=2021-08-01>=>"6%",
      <Period type:month value=2021-09-01>=>"7%",
      <Period type:month value=2021-10-01>=>"8%"},
     {"Facilities"=>"PHC Radicchioville",
      "Total assigned"=>"65",
      "Total registered"=>"67",
      "6 month change"=>"+5%",
      <Period type:month value=2021-05-01>=>"3%",
      <Period type:month value=2021-06-01>=>"3%",
      <Period type:month value=2021-07-01>=>"3%",
      <Period type:month value=2021-08-01>=>"6%",
      <Period type:month value=2021-09-01>=>"8%",
      <Period type:month value=2021-10-01>=>"8%"},
     {"Facilities"=>"Standalone Ginger Bay",
      "Total assigned"=>"22",
      "Total registered"=>"23",
      "6 month change"=>"-8%",
      <Period type:month value=2021-05-01>=>"8%",
      <Period type:month value=2021-06-01>=>"8%",
      <Period type:month value=2021-07-01>=>"0%",
      <Period type:month value=2021-08-01>=>"0%",
      <Period type:month value=2021-09-01>=>"0%",
      <Period type:month value=2021-10-01>=>"0%"},
     {"Facilities"=>"PHC Pepperleaf Town",
      "Total assigned"=>"52",
      "Total registered"=>"53",
      "6 month change"=>"+5%",
      <Period type:month value=2021-05-01>=>"3%",
      <Period type:month value=2021-06-01>=>"4%",
      <Period type:month value=2021-07-01>=>"6%",
      <Period type:month value=2021-08-01>=>"9%",
      <Period type:month value=2021-09-01>=>"5%",
      <Period type:month value=2021-10-01>=>"8%"}]},
 "community"=>
  {"aggregate"=>
    {"Facilities"=>"All HWC/SCs",
     "Total assigned"=>"1",
     "Total registered"=>"1",
     :controlled_patients_rate=>
      {"6 month change"=>0,
       <Period type:month value=2021-05-01>=>0,
       <Period type:month value=2021-06-01>=>0,
       <Period type:month value=2021-07-01>=>0,
       <Period type:month value=2021-08-01>=>0,
       <Period type:month value=2021-09-01>=>0,
       <Period type:month value=2021-10-01>=>0},
     :uncontrolled_patients_rate=>
      {"6 month change"=>0,
       <Period type:month value=2021-05-01>=>0,
       <Period type:month value=2021-06-01>=>0,
       <Period type:month value=2021-07-01>=>0,
       <Period type:month value=2021-08-01>=>0,
       <Period type:month value=2021-09-01>=>0,
       <Period type:month value=2021-10-01>=>0},
     :missed_visits_rate=>
      {"6 month change"=>0,
       <Period type:month value=2021-05-01>=>0,
       <Period type:month value=2021-06-01>=>0,
       <Period type:month value=2021-07-01>=>0,
       <Period type:month value=2021-08-01>=>0,
       <Period type:month value=2021-09-01>=>0,
       <Period type:month value=2021-10-01>=>0}},
   "facilities"=>
    [{"Facilities"=>"Village Herbes de Provence",
      "Total assigned"=>"1",
      "Total registered"=>"1",
      "6 month change"=>"0%",
      <Period type:month value=2021-05-01>=>"0%",
      <Period type:month value=2021-06-01>=>"0%",
      <Period type:month value=2021-07-01>=>"0%",
      <Period type:month value=2021-08-01>=>"0%",
      <Period type:month value=2021-09-01>=>"0%",
      <Period type:month value=2021-10-01>=>"0%"}]}}


      located in MyFacilitiesFiltering
      @selected_facility_group is the first filter
      @selected_zones is second filter
      @selected_facility_sizes is third filter